<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Apache Druid">
<meta name="keywords" content="druid,kafka,database,analytics,streaming,real-time,real time,apache,open source">
<meta name="author" content="Apache Software Foundation">

<title>Druid | Tutorial: Writing an ingestion spec</title>

<link rel="alternate" type="application/atom+xml" href="/feed">
<link rel="shortcut icon" href="/img/favicon.png">

<link rel="stylesheet" href="/assets/css/font-awesome-5.css">

<link href='//fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700,300italic|Open+Sans:300italic,400italic,600italic,400,300,600,700' rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="/css/bootstrap-pure.css?v=1.1">
<link rel="stylesheet" href="/css/base.css?v=1.1">
<link rel="stylesheet" href="/css/header.css?v=1.1">
<link rel="stylesheet" href="/css/footer.css?v=1.1">
<link rel="stylesheet" href="/css/syntax.css?v=1.1">
<link rel="stylesheet" href="/css/docs.css?v=1.1">

<script>
  (function() {
    var cx = '000162378814775985090:molvbm0vggm';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>


  </head>

  <body>
    <!-- Start page_header include -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<div class="top-navigator">
  <div class="container">
    <div class="left-cont">
      <a class="logo" href="/"><span class="druid-logo"></span></a>
    </div>
    <div class="right-cont">
      <ul class="links">
        <li class=""><a href="/technology">Technology</a></li>
        <li class=""><a href="/use-cases">Use Cases</a></li>
        <li class=""><a href="/druid-powered">Powered By</a></li>
        <li class=""><a href="/docs/latest/design/">Docs</a></li>
        <li class=""><a href="/community/">Community</a></li>
        <li class="header-dropdown">
          <a>Apache</a>
          <div class="header-dropdown-menu">
            <a href="https://www.apache.org/" target="_blank">Foundation</a>
            <a href="https://www.apache.org/events/current-event" target="_blank">Events</a>
            <a href="https://www.apache.org/licenses/" target="_blank">License</a>
            <a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a>
            <a href="https://www.apache.org/security/" target="_blank">Security</a>
            <a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a>
          </div>
        </li>
        <li class=" button-link"><a href="/downloads.html">Download</a></li>
      </ul>
    </div>
  </div>
  <div class="action-button menu-icon">
    <span class="fa fa-bars"></span> MENU
  </div>
  <div class="action-button menu-icon-close">
    <span class="fa fa-times"></span> MENU
  </div>
</div>

<script type="text/javascript">
  var $menu = $('.right-cont');
  var $menuIcon = $('.menu-icon');
  var $menuIconClose = $('.menu-icon-close');

  function showMenu() {
    $menu.fadeIn(100);
    $menuIcon.fadeOut(100);
    $menuIconClose.fadeIn(100);
  }

  $menuIcon.click(showMenu);

  function hideMenu() {
    $menu.fadeOut(100);
    $menuIconClose.fadeOut(100);
    $menuIcon.fadeIn(100);
  }

  $menuIconClose.click(hideMenu);

  $(window).resize(function() {
    if ($(window).width() >= 840) {
      $menu.fadeIn(100);
      $menuIcon.fadeOut(100);
      $menuIconClose.fadeOut(100);
    }
    else {
      $menu.fadeOut(100);
      $menuIcon.fadeIn(100);
      $menuIconClose.fadeOut(100);
    }
  });
</script>

<!-- Stop page_header include -->


    <div class="container doc-container">
      
      

      
      <p> Looking for the <a href="/docs/24.0.1/">latest stable documentation</a>?</p>
      

      <div class="row">
        <div class="col-md-9 doc-content">
          <p>
            <a class="btn btn-default btn-xs visible-xs-inline-block visible-sm-inline-block" href="#toc">Table of Contents</a>
          </p>
          <!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<h1 id="tutorial-writing-an-ingestion-spec">Tutorial: Writing an ingestion spec</h1>

<p>This tutorial will guide the reader through the process of defining an ingestion spec, pointing out key considerations and guidelines.</p>

<p>For this tutorial, we&#39;ll assume you&#39;ve already downloaded Druid as described in 
the <a href="index.html">single-machine quickstart</a> and have it running on your local machine. </p>

<p>It will also be helpful to have finished <a href="../tutorials/tutorial-batch.html">Tutorial: Loading a file</a>, <a href="../tutorials/tutorial-query.html">Tutorial: Querying data</a>, and <a href="../tutorials/tutorial-rollup.html">Tutorial: Rollup</a>.</p>

<h2 id="example-data">Example data</h2>

<p>Suppose we have the following network flow data:</p>

<ul>
<li><code>srcIP</code>: IP address of sender</li>
<li><code>srcPort</code>: Port of sender</li>
<li><code>dstIP</code>: IP address of receiver</li>
<li><code>dstPort</code>: Port of receiver</li>
<li><code>protocol</code>: IP protocol number</li>
<li><code>packets</code>: number of packets transmitted</li>
<li><code>bytes</code>: number of bytes transmitted</li>
<li><code>cost</code>: the cost of sending the traffic</li>
</ul>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:01:35Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:01:51Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">3.1</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:01:59Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:02:14Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">7.9</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:02:29Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">10.2</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:03:29Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">4.3</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T02:33:14Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;7.7.7.7&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">22.4</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T02:33:45Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;7.7.7.7&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">20000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">34.5</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T02:35:45Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;7.7.7.7&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">30000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">46.3</span><span class="p">}</span>
</code></pre></div>
<p>Save the JSON contents above into a file called <code>ingestion-tutorial-data.json</code> in <code>quickstart/</code>.</p>

<p>Let&#39;s walk through the process of defining an ingestion spec that can load this data. </p>

<p>For this tutorial, we will be using the native batch indexing task. When using other task types, some aspects of the ingestion spec will differ, and this tutorial will point out such areas.</p>

<h2 id="defining-the-schema">Defining the schema</h2>

<p>The core element of a Druid ingestion spec is the <code>dataSchema</code>. The <code>dataSchema</code> defines how to parse input data into a set of columns that will be stored in Druid.</p>

<p>Let&#39;s start with an empty <code>dataSchema</code> and add fields to it as we progress through the tutorial.</p>

<p>Create a new file called <code>ingestion-tutorial-index.json</code> in <code>quickstart/</code> with the following contents:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{}</span>
</code></pre></div>
<p>We will be making successive edits to this ingestion spec as we progress through the tutorial.</p>

<h3 id="datasource-name">Datasource name</h3>

<p>The datasource name is specified by the <code>dataSource</code> parameter in the <code>dataSchema</code>.</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Let&#39;s call the tutorial datasource <code>ingestion-tutorial</code>.</p>

<h3 id="choose-a-parser">Choose a parser</h3>

<p>A <code>dataSchema</code> has a <code>parser</code> field, which defines the parser that Druid will use to interpret the input data.</p>

<p>Since our input data is represented as JSON strings, we&#39;ll use a <code>string</code> parser with <code>json</code> format:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="time-column">Time column</h3>

<p>The <code>parser</code> needs to know how to extract the main timestamp field from the input data. When using a <code>json</code> type <code>parseSpec</code>, the timestamp is defined in a <code>timestampSpec</code>. </p>

<p>The timestamp column in our input data is named &quot;ts&quot;, containing ISO 8601 timestamps, so let&#39;s add a <code>timestampSpec</code> with that information to the <code>parseSpec</code>:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="column-types">Column types</h3>

<p>Now that we&#39;ve defined the time column, let&#39;s look at definitions for other columns.</p>

<p>Druid supports the following column types: String, Long, Float, Double. We will see how these are used in the following sections.</p>

<p>Before we move on to how we define our other non-time columns, let&#39;s discuss <code>rollup</code> first.</p>

<h3 id="rollup">Rollup</h3>

<p>When ingesting data, we must consider whether we wish to use rollup or not.</p>

<ul>
<li><p>If rollup is enabled, we will need to separate the input columns into two categories, &quot;dimensions&quot; and &quot;metrics&quot;. &quot;Dimensions&quot; are the grouping columns for rollup, while &quot;metrics&quot; are the columns that will be aggregated.</p></li>
<li><p>If rollup is disabled, then all columns are treated as &quot;dimensions&quot; and no pre-aggregation occurs.</p></li>
</ul>

<p>For this tutorial, let&#39;s enable rollup. This is specified with a <code>granularitySpec</code> on the <code>dataSchema</code>. </p>

<p>Note that the <code>granularitySpec</code> lies outside of the <code>parser</code>. We will revist the <code>parser</code> soon when we define our dimensions and metrics.</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="choosing-dimensions-and-metrics">Choosing dimensions and metrics</h4>

<p>For this example dataset, the following is a sensible split for &quot;dimensions&quot; and &quot;metrics&quot;:</p>

<ul>
<li>Dimensions: srcIP, srcPort, dstIP, dstPort, protocol</li>
<li>Metrics: packets, bytes, cost</li>
</ul>

<p>The dimensions here are a group of properties that identify a unidirectional flow of IP traffic, while the metrics represent facts about the IP traffic flow specified by a dimension grouping.</p>

<p>Let&#39;s look at how to define these dimensions and metrics within the ingestion spec.</p>

<h4 id="dimensions">Dimensions</h4>

<p>Dimensions are specified with a <code>dimensionsSpec</code> inside the <code>parseSpec</code>.</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Each dimension has a <code>name</code> and a <code>type</code>, where <code>type</code> can be &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, or &quot;string&quot;.</p>

<p>Note that <code>srcIP</code> is a &quot;string&quot; dimension; for string dimensions, it is enough to specify just a dimension name, since &quot;string&quot; is the default dimension type.</p>

<p>Also note that <code>protocol</code> is a numeric value in the input data, but we are ingesting it as a &quot;string&quot; column; Druid will coerce the input longs to strings during ingestion.</p>

<h5 id="strings-vs-numerics">Strings vs. Numerics</h5>

<p>Should a numeric input be ingested as a numeric dimension or as a string dimension?</p>

<p>Numeric dimensions have the following pros/cons relative to String dimensions:
* Pros: Numeric representation can result in smaller column sizes on disk and lower processing overhead when reading values from the column
* Cons: Numeric dimensions do not have indices, so filtering on them will often be slower than filtering on an equivalent String dimension (which has bitmap indices)</p>

<h4 id="metrics">Metrics</h4>

<p>Metrics are specified with a <code>metricsSpec</code> inside the <code>dataSchema</code>:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>   
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>When defining a metric, it is necessary to specify what type of aggregation should be performed on that column during rollup.</p>

<p>Here we have defined long sum aggregations on the two long metric columns, <code>packets</code> and <code>bytes</code>, and a double sum aggregation for the <code>cost</code> column.</p>

<p>Note that the <code>metricsSpec</code> is on a different nesting level than <code>dimensionSpec</code> or <code>parseSpec</code>; it belongs on the same nesting level as <code>parser</code> within the <code>dataSchema</code>.</p>

<p>Note that we have also defined a <code>count</code> aggregator. The count aggregator will track how many rows in the original input data contributed to a &quot;rolled up&quot; row in the final ingested data.</p>

<h3 id="no-rollup">No rollup</h3>

<p>If we were not using rollup, all columns would be specified in the <code>dimensionsSpec</code>, e.g.:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span>      <span class="s2">&quot;dimensionsSpec&quot;</span> <span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;double&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span><span class="err">,</span>
</code></pre></div>
<h3 id="define-granularities">Define granularities</h3>

<p>At this point, we are done defining the <code>parser</code> and <code>metricsSpec</code> within the <code>dataSchema</code> and we are almost done writing the ingestion spec.</p>

<p>There are some additional properties we need to set in the <code>granularitySpec</code>:
* Type of granularitySpec: <code>uniform</code> and <code>arbitrary</code> are the two supported types. For this tutorial, we will use a <code>uniform</code> granularity spec, where all segments have uniform interval sizes (for example, all segments cover an hour&#39;s worth of data).
* The segment granularity: what size of time interval should a single segment contain data for? e.g., <code>DAY</code>, <code>WEEK</code>
* The bucketing granularity of the timestamps in the time column (referred to as <code>queryGranularity</code>)</p>

<h4 id="segment-granularity">Segment granularity</h4>

<p>Segment granularity is configured by the <code>segmentGranularity</code> property in the <code>granularitySpec</code>. For this tutorial, we&#39;ll create hourly segments:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>      
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
    <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Our input data has events from two separate hours, so this task will generate two segments.</p>

<h4 id="query-granularity">Query granularity</h4>

<p>The query granularity is configured by the <code>queryGranularity</code> property in the <code>granularitySpec</code>. For this tutorial, let&#39;s use minute granularity:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>      
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
    <span class="nt">&quot;queryGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;MINUTE&quot;</span>
    <span class="s2">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>To see the effect of the query granularity, let&#39;s look at this row from the raw input data:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:03:29Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">4.3</span><span class="p">}</span>
</code></pre></div>
<p>When this row is ingested with minute queryGranularity, Druid will floor the row&#39;s timestamp to minute buckets:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="s2">&quot;2018-01-01T01:03:00Z&quot;</span><span class="p">,</span><span class="nt">&quot;srcIP&quot;</span><span class="p">:</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span> <span class="nt">&quot;dstIP&quot;</span><span class="p">:</span><span class="s2">&quot;2.2.2.2&quot;</span><span class="p">,</span> <span class="nt">&quot;srcPort&quot;</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span> <span class="nt">&quot;dstPort&quot;</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nt">&quot;packets&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span> <span class="nt">&quot;cost&quot;</span><span class="p">:</span> <span class="mf">4.3</span><span class="p">}</span>
</code></pre></div>
<h4 id="define-an-interval-batch-only">Define an interval (batch only)</h4>

<p>For batch tasks, it is necessary to define a time interval. Input rows with timestamps outside of the time interval will not be ingested.</p>

<p>The interval is also specified in the <code>granularitySpec</code>:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;dataSchema&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
        <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>      
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
    <span class="nt">&quot;queryGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;MINUTE&quot;</span><span class="p">,</span>
    <span class="nt">&quot;intervals&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2018-01-01/2018-01-02&quot;</span><span class="p">],</span>
    <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="define-the-task-type">Define the task type</h2>

<p>We&#39;ve now finished defining our <code>dataSchema</code>. The remaining steps are to place the <code>dataSchema</code> we created into an ingestion task spec, and specify the input source.</p>

<p>The <code>dataSchema</code> is shared across all task types, but each task type has its own specification format. For this tutorial, we will use the native batch ingestion task:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
  <span class="nt">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;dataSchema&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
      <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
          <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
            <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
          <span class="p">},</span>
          <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
            <span class="p">]</span>              
          <span class="p">}</span>      
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
        <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
        <span class="nt">&quot;queryGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;MINUTE&quot;</span><span class="p">,</span>
        <span class="nt">&quot;intervals&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2018-01-01/2018-01-02&quot;</span><span class="p">],</span>
        <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="define-the-input-source">Define the input source</h2>

<p>Now let&#39;s define our input source, which is specified in an <code>ioConfig</code> object. Each task type has its own type of <code>ioConfig</code>. The native batch task uses &quot;firehoses&quot; to read input data, so let&#39;s configure a &quot;local&quot; firehose to read the example netflow data we saved earlier:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span>    <span class="s2">&quot;ioConfig&quot;</span> <span class="err">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nt">&quot;firehose&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
        <span class="nt">&quot;baseDir&quot;</span> <span class="p">:</span> <span class="s2">&quot;quickstart/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;filter&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial-data.json&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
  <span class="nt">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;dataSchema&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
      <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
          <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
            <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
          <span class="p">},</span>
          <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>      
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
        <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
        <span class="nt">&quot;queryGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;MINUTE&quot;</span><span class="p">,</span>
        <span class="nt">&quot;intervals&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2018-01-01/2018-01-02&quot;</span><span class="p">],</span>
        <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;ioConfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nt">&quot;firehose&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
        <span class="nt">&quot;baseDir&quot;</span> <span class="p">:</span> <span class="s2">&quot;quickstart/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;filter&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial-data.json&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="additional-tuning">Additional tuning</h2>

<p>Each ingestion task has a <code>tuningConfig</code> section that allows users to tune various ingestion parameters.</p>

<p>As an example, let&#39;s add a <code>tuningConfig</code> that sets a target segment size for the native batch ingestion task:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span>    <span class="s2">&quot;tuningConfig&quot;</span> <span class="err">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nt">&quot;targetPartitionSize&quot;</span> <span class="p">:</span> <span class="mi">5000000</span>
    <span class="p">}</span>
</code></pre></div>
<p>Note that each ingestion task has its own type of <code>tuningConfig</code>.</p>

<h2 id="final-spec">Final spec</h2>

<p>We&#39;ve finished defining the ingestion spec, it should now look like the following:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
  <span class="nt">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;dataSchema&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;dataSource&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">,</span>
      <span class="nt">&quot;parser&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="nt">&quot;parseSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
          <span class="nt">&quot;timestampSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;format&quot;</span> <span class="p">:</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span>
            <span class="nt">&quot;column&quot;</span> <span class="p">:</span> <span class="s2">&quot;ts&quot;</span>
          <span class="p">},</span>
          <span class="nt">&quot;dimensionsSpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&quot;srcIP&quot;</span><span class="p">,</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;srcPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstIP&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;dstPort&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">,</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>      
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;metricsSpec&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;count&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;packets&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;longSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;bytes&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;doubleSum&quot;</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="nt">&quot;fieldName&quot;</span> <span class="p">:</span> <span class="s2">&quot;cost&quot;</span> <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;granularitySpec&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
        <span class="nt">&quot;segmentGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;HOUR&quot;</span><span class="p">,</span>
        <span class="nt">&quot;queryGranularity&quot;</span> <span class="p">:</span> <span class="s2">&quot;MINUTE&quot;</span><span class="p">,</span>
        <span class="nt">&quot;intervals&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2018-01-01/2018-01-02&quot;</span><span class="p">],</span>
        <span class="nt">&quot;rollup&quot;</span> <span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;ioConfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nt">&quot;firehose&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
        <span class="nt">&quot;baseDir&quot;</span> <span class="p">:</span> <span class="s2">&quot;quickstart/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;filter&quot;</span> <span class="p">:</span> <span class="s2">&quot;ingestion-tutorial-data.json&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;tuningConfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nt">&quot;targetPartitionSize&quot;</span> <span class="p">:</span> <span class="mi">5000000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="submit-the-task-and-query-the-data">Submit the task and query the data</h2>

<p>From the apache-druid-0.13.0-incubating package root, run the following command:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>bin/post-index-task --file quickstart/ingestion-tutorial-index.json 
</code></pre></div>
<p>After the script completes, we will query the data.</p>

<p>Let&#39;s run <code>bin/dsql</code> and issue a <code>select * from &quot;ingestion-tutorial&quot;;</code> query to see what data was ingested.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ bin/dsql
Welcome to dsql, the command-line client <span class="k">for</span> Druid SQL.
Type <span class="s2">&quot;\h&quot;</span> <span class="k">for</span> help.
dsql&gt; <span class="k">select</span> * from <span class="s2">&quot;ingestion-tutorial&quot;</span><span class="p">;</span>

┌──────────────────────────┬───────┬──────┬───────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ __time                   │ bytes │ cost │ count │ dstIP   │ dstPort │ packets │ protocol │ srcIP   │ srcPort │
├──────────────────────────┼───────┼──────┼───────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ <span class="m">2018</span>-01-01T01:01:00.000Z │  <span class="m">6000</span> │  <span class="m">4</span>.9 │     <span class="m">3</span> │ <span class="m">2</span>.2.2.2 │    <span class="m">3000</span> │      <span class="m">60</span> │ <span class="m">6</span>        │ <span class="m">1</span>.1.1.1 │    <span class="m">2000</span> │
│ <span class="m">2018</span>-01-01T01:02:00.000Z │  <span class="m">9000</span> │ <span class="m">18</span>.1 │     <span class="m">2</span> │ <span class="m">2</span>.2.2.2 │    <span class="m">7000</span> │      <span class="m">90</span> │ <span class="m">6</span>        │ <span class="m">1</span>.1.1.1 │    <span class="m">5000</span> │
│ <span class="m">2018</span>-01-01T01:03:00.000Z │  <span class="m">6000</span> │  <span class="m">4</span>.3 │     <span class="m">1</span> │ <span class="m">2</span>.2.2.2 │    <span class="m">7000</span> │      <span class="m">60</span> │ <span class="m">6</span>        │ <span class="m">1</span>.1.1.1 │    <span class="m">5000</span> │
│ <span class="m">2018</span>-01-01T02:33:00.000Z │ <span class="m">30000</span> │ <span class="m">56</span>.9 │     <span class="m">2</span> │ <span class="m">8</span>.8.8.8 │    <span class="m">5000</span> │     <span class="m">300</span> │ <span class="m">17</span>       │ <span class="m">7</span>.7.7.7 │    <span class="m">4000</span> │
│ <span class="m">2018</span>-01-01T02:35:00.000Z │ <span class="m">30000</span> │ <span class="m">46</span>.3 │     <span class="m">1</span> │ <span class="m">8</span>.8.8.8 │    <span class="m">5000</span> │     <span class="m">300</span> │ <span class="m">17</span>       │ <span class="m">7</span>.7.7.7 │    <span class="m">4000</span> │
└──────────────────────────┴───────┴──────┴───────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘
Retrieved <span class="m">5</span> rows in <span class="m">0</span>.12s.

dsql&gt; 
</code></pre></div>
        </div>
        <div class="col-md-3">
          <div class="searchbox">
            <gcse:searchbox-only></gcse:searchbox-only>
          </div>
          <div id="toc" class="nav toc hidden-print">
          </div>
        </div>
      </div>
    </div>

    <!-- Start page_footer include -->
<footer class="druid-footer">
<div class="container">
  <div class="text-center">
    <p>
    <a href="/technology">Technology</a>&ensp;·&ensp;
    <a href="/use-cases">Use Cases</a>&ensp;·&ensp;
    <a href="/druid-powered">Powered by Druid</a>&ensp;·&ensp;
    <a href="/docs/latest/">Docs</a>&ensp;·&ensp;
    <a href="/community/">Community</a>&ensp;·&ensp;
    <a href="/downloads.html">Download</a>&ensp;·&ensp;
    <a href="/faq">FAQ</a>
    </p>
  </div>
  <div class="text-center">
    <a title="Join the user group" href="https://groups.google.com/forum/#!forum/druid-user" target="_blank"><span class="fa fa-comments"></span></a>&ensp;·&ensp;
    <a title="Follow Druid" href="https://twitter.com/druidio" target="_blank"><span class="fab fa-twitter"></span></a>&ensp;·&ensp;
    <a title="GitHub" href="https://github.com/apache/druid" target="_blank"><span class="fab fa-github"></span></a>
  </div>
  <div class="text-center license">
    Copyright © 2020 <a href="https://www.apache.org/" target="_blank">Apache Software Foundation</a>.<br>
    Except where otherwise noted, licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.<br>
    Apache Druid, Druid, and the Druid logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
  </div>
</div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131010415-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-131010415-1');
</script>
<script>
  function trackDownload(type, url) {
    ga('send', 'event', 'download', type, url);
  }
</script>
<script src="//code.jquery.com/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="/assets/js/druid.js"></script>
<!-- stop page_footer include -->


    <script>
    $(function() {
      $(".toc").load("/docs/0.13.0-incubating/toc.html");

      // There is no way to tell when .gsc-input will be async loaded into the page so just try to set a placeholder until it works
      var tries = 0;
      var timer = setInterval(function() {
        tries++;
        if (tries > 300) clearInterval(timer);
        var searchInput = $('input.gsc-input');
        if (searchInput.length) {
          searchInput.attr('placeholder', 'Search');
          clearInterval(timer);
        }
      }, 100);
    });
    </script>
  </body>
</html>
